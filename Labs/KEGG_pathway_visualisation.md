---
layout: default
title:  'KEGG'
---

# Visualize data in KEGG pathways using R



## Identify KEGG pathways

To get this to work you need to have a set of DE genes. In this example generated by DEseq2

Run the [DEseq2](DEseq2) to generate an appropriate list. 

To identify the KEGG pathway you are interested there are multiple ways. One way, if working in human, is to run the [GeneSet analysis](GSA_tutorial). To identify the KEGG pathways, insted of the hallmark genesets, download the KEGGpathways found on the [Molecular Signatures Database (MSigDB)] (http://software.broadinstitute.org/gsea/msigdb/collections.jsp and store it on your local computer. 


	kegg <- loadGSC(paste(params$workingDirectory,"genesets/c2.cp.kegg.v5.2.symbols.gmt", sep = "/"),type="gmt")
    gsaResKEGG <- runGSA(padj,log2fc, gsc=kegg,ncpus=4)

	GSAsummaryTable = GSAsummaryTable(gsaResKEGG)
	GSAsummaryTable.sorted = GSAsummaryTable[order(GSAsummaryTable[,c("p adj (non-dir.)")]),]
	GSAsummaryTable.sorted.significant = GSAsummaryTable.sorted[GSAsummaryTable.sorted$`p (non-dir.)`<0.01, ]
	KeggTable = GSAsummaryTable.sorted.significant[, c(1,2)]
	kable(KeggTable)
	
	
	
Based on the list select pathways that you want to examine in detail. As an example one of the enriched pathways are __KEGG_GLYCOLYSIS_GLUCONEOGENESIS__. Go to [KEGG pathway webbpage](http://www.genome.jp/kegg/pathway.html) to identify the pathway ID. After filling in the right organism prefix (__hsa__) and __GLYCOLYSIS__ __GLUCONEOGENESIS__ in keywords the first hit is the Glycolysis/Gluconeogenesis pathway with the KEGGID __hsa00010__.

## Visualize the diff exp genes on pathway

	#source("https://bioconductor.org/biocLite.R")
	#biocLite("BiocUpgrade")
	#biocLite("pathview")


	library(ggplot2)
	library(pathview)



	#Load DE genes from DEseq2
	humanGBPDE = read.table(file = /path/to/file/diffExp.DEseq2.all.txt", sep = "\t")
	#keep only log2foldChange and adjusted pvalues
	humanGBPDEmin <- humanGBPDE[ ,c("log2FoldChange","padj") ] 

	#Fix the ENSEMBLIDs so that they are comparable (different for each sample check if you have to do it for yours.
	humanGBPDEmin$ensembl = rownames(humanGBPDEmin)
	humanGBPDEmin$ensembl = gsub("\\..*$" , "" ,humanGBPDEmin$ensembl)

	# load mart to get other names to be able to analyse with the different programs
	mart <- useMart("ENSEMBL_MART_ENSEMBL", dataset = "hsapiens_gene_ensembl", host="www.ensembl.org")
	ensembl2name <- getBM(attributes=c("ensembl_gene_id","external_gene_name","entrezgene"),mart=mart)


	# merge info and remove genes with no info or duplicated and set external_gene_name as rownames instead of ENSEMBLID
	# merge info
	geneLevelStats <- merge(x=humanGBPDEmin, y=ensembl2name, by.x="ensembl", by.y="ensembl_gene_id", all.x=TRUE)
	# sort results so most diff exp genes at the top
	geneLevelStats <- geneLevelStats[order(geneLevelStats$padj),]
	# Remove duplicate genes
	geneLevelStats.uniq = geneLevelStats[!duplicated(geneLevelStats$external_gene_name),]
	# Remove genes with no name
	geneLevelStats.uniq.known = geneLevelStats.uniq[ -which(is.na(geneLevelStats.uniq$external_gene_name)),]

	#Fix colnames and rownames
	colnames(geneLevelStats.uniq.known) <- c("ensembl","log2fc","padj","gene","entrezID")
	rownames(geneLevelStats.uniq.known) <- geneLevelStats.uniq.known[,c("gene")]

	
	#change it into a matrix
	diffexpGenes = as.matrix(geneLevelStats.uniq.known[,2])
	rownames(diffexpGenes) = geneLevelStats.uniq.known$entrezID

	#Generate the plot (will download the corrext info from the KEGG database given the pathwayID   and the species
	pv.out <- pathview(gene.data = diffexpGenes[,1], pathway.id = "00010",
                   species = "hsa", out.suffix = "GLYCOLYSIS GLUCONEOGENESIS",kegg.native = TRUE, same.layer = FALSE)



This will generate a plot were the diffexp genes that you have in your data will be mapped onto the KEGG pathway. 



	
	

